<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <title>desisukh</title>
  <meta name="description" content="Indian hot reels - Watch thousands of Indian, Tamil hot reels, desi girls reels and bhabhi hot videos." />
  <meta name="robots" content="index, follow" />

  <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon.png">
  <link rel="stylesheet" href="assets/css/style.css" />

  <!-- jQuery CDN -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7T1QSE879V"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-7T1QSE879V'); 
  </script>
</head>
<body>

  <!-- Header -->
  <header>
    <img src="assets/img/logo.png" class="logo" alt="Logo">
    <img src="assets/icons/animated-icon.png" class="live-icon" alt="Live">
  </header>

  <!-- Main Scroll Container -->
  <main>
    <div id="reelContainer" class="scroll-container">
      <div class="loading">⏳ Loading reels...</div>
    </div>
  </main>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button><img src="assets/icons/home.png" alt="Home"><span>Home</span></button>
    <button><img src="assets/icons/search.png" alt="Search"><span>Search</span></button>
    <button><img src="assets/icons/saved.png" alt="Saved"><span>Saved</span></button>
    <button><img src="assets/icons/login.png" alt="Login"><span>Login</span></button>
  </nav>

  <!-- Fixed Footer Ad -->
  <script type="text/javascript">
    $(document).ready(function() {
      $("img#closed").click(function() {
        $("#bl_banner").hide(90);
      });
    });
  </script>

  <div id="fixedban" style="width:100%;margin:auto;text-align:center;position:fixed;top:0;z-index:999;">
    <div id="bl_banner" style="text-align:center;max-width:728px;margin:auto;background:#fff;padding:5px;border-radius:8px;box-shadow:0 0 8px rgba(0,0,0,0.2);">
      <img id="closed" src="assets/icons/close.png" alt="Close" style="position:absolute;top:5px;right:5px;width:18px;height:18px;cursor:pointer;">
      <script type="text/javascript">
        atOptions = {
          'key' : 'beb4357a9f3e3cb4ad23051f64297ec4',
          'format' : 'iframe',
          'height' : 50,
          'width' : 320,
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/beb4357a9f3e3cb4ad23051f64297ec4/invoke.js"></script>
    </div>
  </div>

  <!-- Main JS -->
  <script>
    window.WORKER_BASE = "https://reel-hub.govty02.workers.dev";

    async function loadVideos() {
      const container = document.getElementById("reelContainer");
      container.innerHTML = "<div class='loading'>⏳ Loading reels...</div>";

      try {
        const res = await fetch(window.WORKER_BASE + "/videos"); // ✅ FIXED
        const data = await res.json();
        container.innerHTML = "";

        if (!data.videos || data.videos.length === 0) {
          container.innerHTML = "<p>कोई वीडियो नहीं मिला।</p>";
          return;
        }

        data.videos.forEach(video => {
          const reel = document.createElement("div");
          reel.className = "reel";

          reel.innerHTML = `
            <video class="reel-video" src="${video.url}" autoplay loop muted playsinline></video>
            <div class="loading-overlay">⏳</div>
            <div class="footer-tags">#hot #desi #bhabhi</div>
            <div class="play-pause-btn">▶</div>
            <div class="right-icons">
              <div class="icon-btn like-btn"><img src="assets/icons/like.png"><span>120</span></div>
              <div class="icon-btn comment-btn"><img src="assets/icons/comment.png"><span>15</span></div>
              <div class="icon-btn share-btn"><img src="assets/icons/share.png"><span>Share</span></div>
              <button class="icon-btn audio-btn">
                <img src="assets/icons/speaker-off.png" alt="Mute/Unmute">
              </button>
            </div>
          `;

          const vidEl = reel.querySelector(".reel-video");
          const playBtn = reel.querySelector(".play-pause-btn");
          const audioBtn = reel.querySelector(".audio-btn");
          const audioImg = audioBtn.querySelector("img");

          // Loader remove when video is ready
          vidEl.addEventListener("loadeddata", () => {
            reel.querySelector(".loading-overlay")?.remove();
          });

          // Play/Pause toggle
          const toggleVideo = () => {
            if (vidEl.paused) {
              vidEl.play().catch(()=>{});
              playBtn.style.display="none";
            } else {
              vidEl.pause();
              playBtn.style.display="flex";
            }
          };
          vidEl.addEventListener("click", toggleVideo);
          playBtn.addEventListener("click", toggleVideo);

          // Audio toggle
          audioBtn.addEventListener("click", () => {
            vidEl.muted = !vidEl.muted;
            audioImg.src = vidEl.muted ? "assets/icons/speaker-off.png" : "assets/icons/speaker-on.png";
          });

          container.appendChild(reel);
        });

        // ✅ Only one reel play at a time
        function handleScrollPause() {
          const reels = document.querySelectorAll(".reel-video");
          reels.forEach(v => {
            const rect = v.getBoundingClientRect();
            const fullyVisible = rect.top >= 0 && rect.bottom <= window.innerHeight;
            if (fullyVisible) {
              v.play().catch(()=>{});
            } else {
              v.pause();
            }
          });
        }
        window.addEventListener("scroll", handleScrollPause);
        handleScrollPause();

      } catch (err) {
        console.error("Error loading videos:", err);
        container.innerHTML = "<p>⚠️ वीडियो लोड नहीं हो पाए।</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadVideos();

      const btns = document.querySelectorAll(".bottom-nav button");
      btns[0].onclick = () => window.location.href = "/";
      btns[1].onclick = () => alert("Search feature coming soon.");
      btns[2].onclick = () => alert("Bookmark feature coming soon.");
      btns[3].onclick = () => alert("Login feature coming soon.");
    });
  </script>
</body>
</html>
